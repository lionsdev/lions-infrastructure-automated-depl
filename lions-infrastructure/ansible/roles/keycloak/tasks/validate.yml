---
# =========================================================================
# LIONS INFRASTRUCTURE 5.0 - VALIDATION KEYCLOAK
# =========================================================================
# Description: Validation post-dÃ©ploiement complÃ¨te pour Keycloak
# Version: 5.0.0
# Maintainer: DevOps Team
# Documentation: https://docs.lions.dev/infrastructure/keycloak/validation
# =========================================================================

# =========================================================================
# INITIALISATION ET CONFIGURATION
# =========================================================================
- name: "ğŸ”§ [INIT] Configuration des variables de validation Keycloak"
  set_fact:
    keycloak_validation_config:
      # Configuration des timeouts et retry basÃ©e sur les variables d'environnement
      health_check_timeout: "{{ lions_timeout_default | default(300) }}"
      health_check_retries: "{{ 30 if lions_environment == 'production' else 20 }}"
      health_check_delay: "{{ 10 if lions_environment == 'production' else 5 }}"

      # URLs et endpoints
      internal_base_url: "http://{{ lions_keycloak_service_name }}.{{ lions_keycloak_namespace }}.svc.{{ lions_k8s_dns_domain }}:{{ lions_keycloak_port }}"
      external_base_url: "{{ 'https' if lions_security_tls_enabled | bool else 'http' }}://{{ lions_keycloak_service_name }}.{{ lions_dns_full_domain }}"

      # Chemins d'API
      health_path: "/health"
      ready_path: "/health/ready"
      live_path: "/health/live"
      admin_path: "/admin"
      metrics_path: "/metrics"
      auth_path: "/realms/{{ lions_keycloak_realm }}"

      # Configuration de sÃ©curitÃ©
      tls_verify: "{{ not (lions_environment == 'development' and lions_debug_mode | bool) }}"

      # Configuration du monitoring
      metrics_enabled: "{{ lions_monitoring_enabled | bool and lions_prometheus_enabled | bool }}"

    # Variables dynamiques
    keycloak_deployment_info:
      name: "{{ lions_keycloak_service_name }}"
      namespace: "{{ lions_keycloak_namespace }}"
      environment: "{{ lions_environment }}"
      version: "{{ lions_keycloak_version }}"
      timestamp: "{{ ansible_date_time.iso8601 }}"

- name: "ğŸ“‹ [INIT] Affichage de la configuration de validation"
  debug:
    msg:
      - "ğŸ” Validation Keycloak pour l'environnement: {{ lions_environment | upper }}"
      - "ğŸ·ï¸  Service: {{ keycloak_deployment_info.name }}"
      - "ğŸ“¦ Namespace: {{ keycloak_deployment_info.namespace }}"
      - "ğŸ”— URL interne: {{ keycloak_validation_config.internal_base_url }}"
      - "ğŸŒ URL externe: {{ keycloak_validation_config.external_base_url }}"
      - "â±ï¸  Timeout: {{ keycloak_validation_config.health_check_timeout }}s"
  when: lions_debug_mode | bool

# =========================================================================
# VALIDATIONS PRÃ‰LIMINAIRES
# =========================================================================
- name: "ğŸ” [VALIDATION] VÃ©rification de la prÃ©sence du dÃ©ploiement Keycloak"
  k8s_info:
    api_version: apps/v1
    kind: Deployment
    name: "{{ keycloak_deployment_info.name }}"
    namespace: "{{ keycloak_deployment_info.namespace }}"
    wait: true
    wait_condition:
      type: Available
      status: "True"
    wait_timeout: "{{ keycloak_validation_config.health_check_timeout }}"
  register: keycloak_deployment_status
  failed_when: false

- name: "âŒ [ERROR] Ã‰chec si le dÃ©ploiement Keycloak n'existe pas"
  fail:
    msg: |
      âŒ Le dÃ©ploiement Keycloak '{{ keycloak_deployment_info.name }}' n'a pas Ã©tÃ© trouvÃ© dans le namespace '{{ keycloak_deployment_info.namespace }}'.
      ğŸ” VÃ©rifiez que le dÃ©ploiement a Ã©tÃ© crÃ©Ã© correctement.
  when: keycloak_deployment_status.resources | length == 0

- name: "ğŸ“Š [INFO] Statut du dÃ©ploiement Keycloak"
  debug:
    msg:
      - "ğŸ“ˆ RÃ©pliques souhaitÃ©es: {{ keycloak_deployment_status.resources[0].spec.replicas }}"
      - "âœ… RÃ©pliques disponibles: {{ keycloak_deployment_status.resources[0].status.readyReplicas | default(0) }}"
      - "ğŸ”„ RÃ©pliques mises Ã  jour: {{ keycloak_deployment_status.resources[0].status.updatedReplicas | default(0) }}"
  when:
    - keycloak_deployment_status.resources | length > 0
    - lions_debug_mode | bool

# =========================================================================
# VALIDATION DE SANTÃ‰ APPLICATIVE
# =========================================================================
- name: "ğŸ¥ [HEALTH] VÃ©rification de l'endpoint de santÃ© Keycloak"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.health_path }}"
    method: GET
    status_code: [200, 204]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
    follow_redirects: safe
  register: keycloak_health_check
  until: keycloak_health_check.status in [200, 204]
  retries: "{{ keycloak_validation_config.health_check_retries }}"
  delay: "{{ keycloak_validation_config.health_check_delay }}"
  failed_when: false
  tags: ['health', 'validation']

- name: "ğŸŸ¢ [SUCCESS] Keycloak - Ã‰tat de santÃ© OK"
  debug:
    msg: |
      âœ… Keycloak '{{ keycloak_deployment_info.name }}' est en bonne santÃ©
      ğŸ“¡ RÃ©ponse HTTP: {{ keycloak_health_check.status }}
      â±ï¸  Temps de rÃ©ponse: {{ keycloak_health_check.elapsed }}s
  when: keycloak_health_check.status in [200, 204]

- name: "ğŸ”´ [WARNING] Keycloak - ProblÃ¨me de santÃ© dÃ©tectÃ©"
  debug:
    msg: |
      âš ï¸  ATTENTION: Keycloak '{{ keycloak_deployment_info.name }}' prÃ©sente des problÃ¨mes de santÃ©
      ğŸ“¡ Code de rÃ©ponse: {{ keycloak_health_check.status | default('N/A') }}
      âŒ Message d'erreur: {{ keycloak_health_check.msg | default('Timeout ou connexion impossible') }}
      ğŸ” Action recommandÃ©e: VÃ©rifiez les logs du conteneur Keycloak
  when: keycloak_health_check.status not in [200, 204]

# =========================================================================
# VALIDATION DE DISPONIBILITÃ‰
# =========================================================================
- name: "ğŸš€ [READINESS] VÃ©rification de la disponibilitÃ© Keycloak"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.ready_path }}"
    method: GET
    status_code: [200, 204]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
  register: keycloak_readiness_check
  until: keycloak_readiness_check.status in [200, 204]
  retries: "{{ keycloak_validation_config.health_check_retries }}"
  delay: "{{ keycloak_validation_config.health_check_delay }}"
  failed_when: false
  tags: ['readiness', 'validation']

- name: "ğŸŸ¢ [SUCCESS] Keycloak - PrÃªt Ã  recevoir du trafic"
  debug:
    msg: |
      âœ… Keycloak '{{ keycloak_deployment_info.name }}' est prÃªt Ã  recevoir du trafic
      ğŸ”— Endpoint: {{ keycloak_validation_config.ready_path }}
      ğŸ“¡ Statut: {{ keycloak_readiness_check.status }}
  when: keycloak_readiness_check.status in [200, 204]

# =========================================================================
# VALIDATION DE L'ACCESSIBILITÃ‰ EXTERNE
# =========================================================================
- name: "ğŸŒ [EXTERNAL] VÃ©rification de l'accessibilitÃ© externe"
  uri:
    url: "{{ keycloak_validation_config.external_base_url }}{{ keycloak_validation_config.health_path }}"
    method: GET
    status_code: [200, 204, 301, 302, 307, 308]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
    follow_redirects: no
  register: keycloak_external_check
  failed_when: false
  when: lions_security_tls_enabled | bool
  tags: ['external', 'ingress']

- name: "ğŸŸ¢ [SUCCESS] Keycloak - Accessible depuis l'extÃ©rieur"
  debug:
    msg: |
      âœ… Keycloak '{{ keycloak_deployment_info.name }}' est accessible depuis l'extÃ©rieur
      ğŸ”— URL: {{ keycloak_validation_config.external_base_url }}
      ğŸ“¡ Statut HTTP: {{ keycloak_external_check.status }}
  when:
    - keycloak_external_check is defined
    - keycloak_external_check.status in [200, 204, 301, 302, 307, 308]

- name: "ğŸ”´ [WARNING] Keycloak - ProblÃ¨me d'accÃ¨s externe"
  debug:
    msg: |
      âš ï¸  ATTENTION: Keycloak '{{ keycloak_deployment_info.name }}' n'est pas accessible depuis l'extÃ©rieur
      ğŸ”— URL testÃ©e: {{ keycloak_validation_config.external_base_url }}
      ğŸ“¡ Statut: {{ keycloak_external_check.status | default('N/A') }}
      ğŸ” VÃ©rifiez la configuration de l'Ingress et des certificats TLS
  when:
    - keycloak_external_check is defined
    - keycloak_external_check.status not in [200, 204, 301, 302, 307, 308]

# =========================================================================
# VALIDATION DE LA CONSOLE D'ADMINISTRATION
# =========================================================================
- name: "ğŸ‘‘ [ADMIN] VÃ©rification de l'accÃ¨s Ã  la console d'administration"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.admin_path }}"
    method: GET
    status_code: [200, 401, 403]  # 401/403 sont acceptables (authentification requise)
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
  register: keycloak_admin_check
  failed_when: false
  tags: ['admin', 'security']

- name: "ğŸŸ¢ [SUCCESS] Console d'administration accessible"
  debug:
    msg: |
      âœ… Console d'administration Keycloak accessible
      ğŸ”— Endpoint: {{ keycloak_validation_config.admin_path }}
      ğŸ“¡ Statut: {{ keycloak_admin_check.status }}
      {{ 'ğŸ” Authentification requise (normal)' if keycloak_admin_check.status in [401, 403] else 'ğŸ”“ AccÃ¨s direct possible' }}
  when: keycloak_admin_check.status in [200, 401, 403]

# =========================================================================
# VALIDATION DES REALMS
# =========================================================================
- name: "ğŸ° [REALM] VÃ©rification du realm principal"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.auth_path }}"
    method: GET
    status_code: [200]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
  register: keycloak_realm_check
  failed_when: false
  tags: ['realm', 'auth']

- name: "ğŸŸ¢ [SUCCESS] Realm principal accessible"
  debug:
    msg: |
      âœ… Realm '{{ lions_keycloak_realm }}' est accessible
      ğŸ”— Endpoint: {{ keycloak_validation_config.auth_path }}
      ğŸ“¡ Statut: {{ keycloak_realm_check.status }}
  when: keycloak_realm_check.status == 200

- name: "ğŸ”´ [WARNING] ProblÃ¨me avec le realm principal"
  debug:
    msg: |
      âš ï¸  ATTENTION: Le realm '{{ lions_keycloak_realm }}' n'est pas accessible
      ğŸ“¡ Statut: {{ keycloak_realm_check.status | default('N/A') }}
      ğŸ” VÃ©rifiez la configuration du realm dans Keycloak
  when: keycloak_realm_check.status != 200

# =========================================================================
# VALIDATION DU MONITORING
# =========================================================================
- name: "ğŸ“Š [METRICS] VÃ©rification des mÃ©triques Prometheus"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.metrics_path }}"
    method: GET
    status_code: [200]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
  register: keycloak_metrics_check
  failed_when: false
  when: keycloak_validation_config.metrics_enabled | bool
  tags: ['metrics', 'monitoring']

- name: "ğŸŸ¢ [SUCCESS] MÃ©triques Prometheus disponibles"
  debug:
    msg: |
      âœ… MÃ©triques Prometheus accessibles pour Keycloak
      ğŸ”— Endpoint: {{ keycloak_validation_config.metrics_path }}
      ğŸ“Š DonnÃ©es collectÃ©es avec succÃ¨s
  when:
    - keycloak_validation_config.metrics_enabled | bool
    - keycloak_metrics_check.status == 200

- name: "ğŸ”´ [WARNING] MÃ©triques Prometheus indisponibles"
  debug:
    msg: |
      âš ï¸  ATTENTION: Les mÃ©triques Prometheus ne sont pas disponibles
      ğŸ“¡ Statut: {{ keycloak_metrics_check.status | default('N/A') }}
      ğŸ” VÃ©rifiez la configuration des mÃ©triques dans Keycloak
  when:
    - keycloak_validation_config.metrics_enabled | bool
    - keycloak_metrics_check.status != 200

# =========================================================================
# VALIDATION DE LA CONNECTIVITÃ‰ BASE DE DONNÃ‰ES
# =========================================================================
- name: "ğŸ—„ï¸  [DATABASE] VÃ©rification de la connectivitÃ© base de donnÃ©es"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.ready_path }}"
    method: GET
    status_code: [200]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 30
  register: keycloak_db_connectivity
  failed_when: false
  tags: ['database', 'connectivity']

- name: "ğŸŸ¢ [SUCCESS] ConnectivitÃ© base de donnÃ©es OK"
  debug:
    msg: |
      âœ… ConnectivitÃ© base de donnÃ©es fonctionnelle
      ğŸ”— Keycloak peut accÃ©der Ã  sa base de donnÃ©es
      ğŸ“Š Statut: {{ keycloak_db_connectivity.status }}
  when: keycloak_db_connectivity.status == 200

# =========================================================================
# VALIDATION DES PERFORMANCES
# =========================================================================
- name: "âš¡ [PERFORMANCE] Test de performance basique"
  uri:
    url: "{{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.health_path }}"
    method: GET
    status_code: [200, 204]
    validate_certs: "{{ keycloak_validation_config.tls_verify }}"
    timeout: 10
  register: keycloak_perf_test
  with_sequence: start=1 end=5
  failed_when: false
  when: lions_environment == 'production'
  tags: ['performance']

- name: "ğŸ“ˆ [PERFORMANCE] RÃ©sultats du test de performance"
  debug:
    msg: |
      ğŸ“Š Test de performance Keycloak ({{ item.item }}/5):
      â±ï¸  Temps de rÃ©ponse: {{ item.elapsed }}s
      ğŸ“¡ Statut: {{ item.status }}
  loop: "{{ keycloak_perf_test.results | default([]) }}"
  when:
    - lions_environment == 'production'
    - keycloak_perf_test.results is defined

# =========================================================================
# SYNTHÃˆSE DE VALIDATION
# =========================================================================
- name: "ğŸ“‹ [SUMMARY] Calcul du score de validation"
  set_fact:
    keycloak_validation_score:
      health_ok: "{{ keycloak_health_check.status in [200, 204] }}"
      readiness_ok: "{{ keycloak_readiness_check.status in [200, 204] }}"
      external_ok: "{{ keycloak_external_check.status in [200, 204, 301, 302, 307, 308] if keycloak_external_check is defined else true }}"
      admin_ok: "{{ keycloak_admin_check.status in [200, 401, 403] }}"
      realm_ok: "{{ keycloak_realm_check.status == 200 }}"
      metrics_ok: "{{ keycloak_metrics_check.status == 200 if keycloak_validation_config.metrics_enabled | bool else true }}"
      db_ok: "{{ keycloak_db_connectivity.status == 200 }}"

- name: "ğŸ“Š [SUMMARY] Affichage du rÃ©sumÃ© de validation"
  debug:
    msg: |
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ğŸ¯ RÃ‰SUMÃ‰ DE VALIDATION KEYCLOAK - {{ keycloak_deployment_info.environment | upper }}
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      ğŸ“± Service: {{ keycloak_deployment_info.name }}
      ğŸ“¦ Namespace: {{ keycloak_deployment_info.namespace }}
      ğŸ·ï¸  Version: {{ keycloak_deployment_info.version }}
      â° Timestamp: {{ keycloak_deployment_info.timestamp }}
      
      âœ… VALIDATIONS:
      {{ 'âœ…' if keycloak_validation_score.health_ok else 'âŒ' }} SantÃ© applicative
      {{ 'âœ…' if keycloak_validation_score.readiness_ok else 'âŒ' }} DisponibilitÃ©
      {{ 'âœ…' if keycloak_validation_score.external_ok else 'âŒ' }} AccessibilitÃ© externe
      {{ 'âœ…' if keycloak_validation_score.admin_ok else 'âŒ' }} Console d'administration  
      {{ 'âœ…' if keycloak_validation_score.realm_ok else 'âŒ' }} Realm principal
      {{ 'âœ…' if keycloak_validation_score.metrics_ok else 'âŒ' }} MÃ©triques Prometheus
      {{ 'âœ…' if keycloak_validation_score.db_ok else 'âŒ' }} ConnectivitÃ© base de donnÃ©es
      
      ğŸ”— URLS:
      ğŸ“ Interne: {{ keycloak_validation_config.internal_base_url }}
      ğŸŒ Externe: {{ keycloak_validation_config.external_base_url }}
      ğŸ‘‘ Admin: {{ keycloak_validation_config.external_base_url }}{{ keycloak_validation_config.admin_path }}
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# =========================================================================
# GÃ‰NÃ‰RATION DU RAPPORT DE VALIDATION
# =========================================================================
- name: "ğŸ“„ [REPORT] CrÃ©ation du rÃ©pertoire de logs"
  file:
    path: "/var/log/lions/validations"
    state: directory
    mode: '0755'
  become: yes
  failed_when: false

- name: "ğŸ“ [REPORT] GÃ©nÃ©ration du rapport de validation"
  copy:
    content: |
      # RAPPORT DE VALIDATION KEYCLOAK - LIONS INFRASTRUCTURE 5.0
      
      ## Informations gÃ©nÃ©rales
      - **Service**: {{ keycloak_deployment_info.name }}
      - **Namespace**: {{ keycloak_deployment_info.namespace }}
      - **Version**: {{ keycloak_deployment_info.version }}
      - **Environnement**: {{ keycloak_deployment_info.environment }}
      - **Date de validation**: {{ keycloak_deployment_info.timestamp }}
      - **ValidÃ© par**: {{ ansible_user_id }}@{{ ansible_hostname }}
      
      ## Configuration de validation
      - **Timeout**: {{ keycloak_validation_config.health_check_timeout }}s
      - **Retries**: {{ keycloak_validation_config.health_check_retries }}
      - **DÃ©lai entre retry**: {{ keycloak_validation_config.health_check_delay }}s
      - **VÃ©rification TLS**: {{ keycloak_validation_config.tls_verify }}
      
      ## RÃ©sultats de validation
      
      ### âœ… Tests rÃ©ussis
      {% for key, value in keycloak_validation_score.items() %}
      {% if value %}
      - {{ key.replace('_', ' ').title() }}
      {% endif %}
      {% endfor %}
      
      ### âŒ Tests Ã©chouÃ©s
      {% for key, value in keycloak_validation_score.items() %}
      {% if not value %}
      - {{ key.replace('_', ' ').title() }}
      {% endif %}
      {% endfor %}
      
      ## URLs validÃ©es
      - **SantÃ©**: {{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.health_path }}
      - **DisponibilitÃ©**: {{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.ready_path }}
      - **Administration**: {{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.admin_path }}
      - **Realm**: {{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.auth_path }}
      {% if keycloak_validation_config.metrics_enabled %}
      - **MÃ©triques**: {{ keycloak_validation_config.internal_base_url }}{{ keycloak_validation_config.metrics_path }}
      {% endif %}
      
      ## Statuts HTTP obtenus
      - **SantÃ©**: {{ keycloak_health_check.status | default('N/A') }}
      - **DisponibilitÃ©**: {{ keycloak_readiness_check.status | default('N/A') }}
      - **Administration**: {{ keycloak_admin_check.status | default('N/A') }}
      - **Realm**: {{ keycloak_realm_check.status | default('N/A') }}
      {% if keycloak_external_check is defined %}
      - **Externe**: {{ keycloak_external_check.status | default('N/A') }}
      {% endif %}
      {% if keycloak_metrics_check is defined %}
      - **MÃ©triques**: {{ keycloak_metrics_check.status | default('N/A') }}
      {% endif %}
      
      ## Recommandations
      {% if not keycloak_validation_score.health_ok %}
      - âš ï¸  VÃ©rifiez les logs du conteneur Keycloak pour identifier les problÃ¨mes de santÃ©
      {% endif %}
      {% if not keycloak_validation_score.external_ok %}
      - âš ï¸  VÃ©rifiez la configuration de l'Ingress et des certificats TLS
      {% endif %}
      {% if not keycloak_validation_score.metrics_ok and keycloak_validation_config.metrics_enabled %}
      - âš ï¸  VÃ©rifiez la configuration des mÃ©triques Prometheus dans Keycloak
      {% endif %}
      {% if not keycloak_validation_score.realm_ok %}
      - âš ï¸  VÃ©rifiez la configuration du realm '{{ lions_keycloak_realm }}' dans Keycloak
      {% endif %}
      
      ## Support
      - **Documentation**: https://docs.lions.dev/infrastructure/keycloak
      - **Contact**: devops@lions.dev
      - **Logs systÃ¨me**: /var/log/lions/validations/
      
      ---
      Rapport gÃ©nÃ©rÃ© automatiquement par LIONS Infrastructure 5.0
    dest: "/var/log/lions/validations/keycloak-{{ keycloak_deployment_info.environment }}-{{ ansible_date_time.date }}-{{ ansible_date_time.hour }}{{ ansible_date_time.minute }}.md"
    mode: '0644'
  become: yes
  failed_when: false

# =========================================================================
# NETTOYAGE ET FINALISATION
# =========================================================================
- name: "ğŸ§¹ [CLEANUP] Nettoyage des variables temporaires"
  set_fact:
    keycloak_validation_config: "{{ omit }}"
    keycloak_deployment_info: "{{ omit }}"
  changed_when: false

- name: "ğŸ‰ [SUCCESS] Validation Keycloak terminÃ©e avec succÃ¨s"
  debug:
    msg: |
      ğŸ¯ Validation de Keycloak terminÃ©e pour l'environnement {{ lions_environment | upper }}
      ğŸ“Š Consultez le rapport dÃ©taillÃ©: /var/log/lions/validations/
      ğŸ” Pour plus d'informations: https://docs.lions.dev/infrastructure/keycloak
  when: keycloak_validation_score.health_ok and keycloak_validation_score.readiness_ok

- name: "âš ï¸  [WARNING] Validation Keycloak terminÃ©e avec des avertissements"
  debug:
    msg: |
      âš ï¸  Validation de Keycloak terminÃ©e avec des avertissements pour {{ lions_environment | upper }}
      ğŸ“Š Consultez le rapport dÃ©taillÃ©: /var/log/lions/validations/
      ğŸ”§ Actions correctives recommandÃ©es - voir le rapport
      ğŸ“ Contact support: devops@lions.dev
  when: not (keycloak_validation_score.health_ok and keycloak_validation_score.readiness_ok)

# =========================================================================
# FIN DE VALIDATION
# =========================================================================